<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>My Radio Station</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>My Radio Station</h1>
        <p>Welcome to my online radio station! Enjoy the music.</p>
    </header>

    <section>
        <h2>Now Playing</h2>
        <p id="trackName">Loading track...</p>
        <progress id="progressBar" value="0" max="100"></progress>
        <p>Current time: <span id="currentTime">00:00</span></p>
        <audio id="audioPlayer" autoplay hidden>
            <source src="audio/program01.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </section>

    <script>
        const audioPlayer = document.getElementById('audioPlayer');
        const trackName = document.getElementById('trackName');
        const progressBar = document.getElementById('progressBar');
        const currentTimeElement = document.getElementById('currentTime');
        const playlistUrl = 'playlist.m3u'; // Путь к вашему плейлисту

        let playlist = [];
        let currentTrack = 0;

        function parsePlaylist(data) {
            return data.split('\n')
                .filter(line => line && !line.startsWith('#'))
                .map(line => line.trim());
        }

        function getTrackDuration(track) {
            return new Promise((resolve) => {
                const tempAudio = new Audio(track);
                tempAudio.addEventListener('loadedmetadata', () => {
                    resolve(tempAudio.duration);
                });
            });
        }

        async function playNextTrack() {
            if (playlist.length === 0) return;

            const trackDuration = await getTrackDuration(playlist[currentTrack]);
            const nextTrack = (currentTrack + 1) % playlist.length;

            audioPlayer.src = playlist[currentTrack];
            trackName.textContent = `Now Playing: ${playlist[currentTrack]}`;
            audioPlayer.play();

            // Update progress and time every second
            const interval = setInterval(() => {
                const currentTime = audioPlayer.currentTime;
                progressBar.value = (currentTime / trackDuration) * 100;
                currentTimeElement.textContent = formatTime(currentTime);
            }, 1000);

            audioPlayer.addEventListener('ended', () => {
                clearInterval(interval);
                currentTrack = nextTrack;
                playNextTrack();
            });
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${minutes}:${secs}`;
        }

        function startPlayback() {
            const now = new Date();
            const nextHour = new Date();
            nextHour.setHours(now.getHours() + 1, 0, 0, 0);

            const delay = nextHour - now;

            setTimeout(() => {
                playNextTrack();
            }, delay);
        }

        fetch(playlistUrl)
            .then(response => response.text())
            .then(data => {
                playlist = parsePlaylist(data);
                startPlayback();
            })
            .catch(error => {
                console.error('Ошибка при загрузке плейлиста:', error);
            });
    </script>
</body>
</html>
